<fragment>
	<log-to-eventhub logger-id="aoailogger">@{
            var requestBody = context.Request.Body?.As<JObject>(true);
            var requestUrl = $"{context.Request.Url.Scheme}://{context.Request.Url.Host}:{context.Request.Url.Port}{context.Request.Url.Path}{context.Request.Url.QueryString}";
            var headers = new JObject();
            foreach(var header in context.Request.Headers)
            {
                if (header.Key == "api-key")
                {
                    continue;
                }
                headers[header.Key] = string.Join(",", header.Value);
            }
            return new JObject(
                new JProperty("type", "Request"),
                new JProperty("timestamp", context.Timestamp),
                new JProperty("subscriptionId", context.Subscription.Id),
                new JProperty("subscriptionName", context.Subscription.Name),
                new JProperty("operationId", context.Operation.Id),
                new JProperty("request", requestBody),
                new JProperty("serviceName", context.Deployment.ServiceName),
                new JProperty("requestId", context.RequestId),
                new JProperty("requestIp", context.Request.IpAddress),
                new JProperty("url", requestUrl),
                new JProperty("operationName", context.Operation.Name),
                new JProperty("region", context.Deployment.Region),
                new JProperty("apiName", context.Api.Name),
                new JProperty("apiRevision", context.Api.Revision),
                new JProperty("method", context.Operation.Method),
                new JProperty("headers", headers)
            ).ToString();
        }
    </log-to-eventhub>
</fragment>